{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lista de Estudiantes</title>
    <link rel="stylesheet" href="{% static 'css/estudiantes.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>

<header>
    <div class="logo">
        <img src="{% static 'img/logo.png' %}" alt="Eduflex">
        <a href="{% url 'profesor:verEstadisticasCurso' %}" class="btn">EstadÃ­sticas generales curso</a>
    </div>
</header>

<div class="regresar">
    <a onclick="window.history.back()" class="boton-recuperar">
        <button class="btn-return"> â† Regresar</button>
    </a>
</div>

<!-- Filtros -->
<div class="filtros">
    <input type="text" id="filtro-nombre" placeholder="Buscar por nombre...">
    <select id="filtro-genero">
        <option value="">Todos los gÃ©neros</option>
        <option value="M">Masculino</option>
        <option value="F">Femenino</option>
    </select>
</div>

<!-- Lista de Estudiantes -->
<div class="container">
    <h1>ğŸ‘¨â€ğŸ“ Estudiantes del Curso</h1>

    <ul class="lista-estudiantes">
        {% for niÃ±o in niÃ±os %}
            <li class="item-estudiante"
                data-nombre="{{ niÃ±o.nombres }} {{ niÃ±o.apellidos }}"
                data-genero="{{ niÃ±o.genero }}">
                <a href="{% url 'profesor:estudiante' curso.id niÃ±o.id %}">
                    {% if niÃ±o.foto_perfil %}
                        <img src="{{ niÃ±o.get_image }}" class="imagen-niÃ±o">
                    {% endif %}
                    <span class="nombre">ğŸ“˜ {{ niÃ±o.nombres }} {{ niÃ±o.apellidos }}</span>
                    <span class="ver-mas">Ver detalle âœ</span>
                </a>
            </li>
        {% empty %}
            <li class="sin-estudiantes">ğŸ˜• No hay estudiantes registrados.</li>
        {% endfor %}
    </ul>
</div>

<!-- Modal para imagen ampliada -->
<div id="modal-imagen" class="modal">
    <span class="cerrar" onclick="cerrarModal()">&times;</span>
    <img class="modal-contenido" id="imagen-ampliada">
</div>

<!-- JS -->
<script>
  // Normaliza texto para bÃºsqueda sin tildes
  function normalizar(texto) {
    return texto.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  }

  document.addEventListener('DOMContentLoaded', function () {
    const inputNombre = document.getElementById("filtro-nombre");
    const selectGenero = document.getElementById("filtro-genero");
    const estudiantes = document.querySelectorAll(".item-estudiante");

    function aplicarFiltro() {
      const nombreValor = normalizar(inputNombre.value);
      const generoValor = selectGenero.value;

      estudiantes.forEach(estudiante => {
        const nombre = normalizar(estudiante.dataset.nombre);
        const genero = estudiante.dataset.genero;

        const coincideNombre = nombre.includes(nombreValor);
        const coincideGenero = !generoValor || genero === generoValor;

        estudiante.style.display = (coincideNombre && coincideGenero) ? "block" : "none";
      });
    }

    inputNombre.addEventListener("input", aplicarFiltro);
    selectGenero.addEventListener("change", aplicarFiltro);

    // Ampliar imagen
    const imagenes = document.querySelectorAll('.imagen-niÃ±o');
    const modal = document.getElementById('modal-imagen');
    const imagenAmpliada = document.getElementById('imagen-ampliada');

    imagenes.forEach(function (img) {
      img.addEventListener('click', function (e) {
        e.preventDefault();
        imagenAmpliada.src = this.src;
        modal.style.display = 'block';
      });
    });
  });

  function cerrarModal() {
    document.getElementById('modal-imagen').style.display = 'none';
  }
</script>

</body>
</html>
