{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reporte del Ni침o</title>
    <link rel="stylesheet" href="{% static 'css/verReporte.css' %}">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="{% static 'js/graficas_reportes.js' %}"></script>
</head>
<body>



    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="datos">游늶 Datos</button>
            <button class="tab-btn" data-tab="graficas">游늵 Gr치ficas</button>
        </div>
        <h1 style="text-align: center;">游늶 Reporte de Evaluaci칩n del Ni침o</h1>

        <!-- TAB: DATOS -->
        <div id="tab-datos" class="tab-content active">
            <div class="resumen">
                <div class="card"><h3>Puntaje</h3><p>{{ reporte.puntaje }}</p></div>
                <div class="card"><h3>Distracciones</h3><p>{{ reporte.distracciones }}</p></div>
                <div class="card"><h3>Somnolencias</h3><p>{{ reporte.somnolencias }}</p></div>
                <div class="card"><h3>Duraci칩n</h3><p>{{ reporte.duracion_evaluacion }}</p></div>
            </div>

            <section>
                <h2>游리 Capturas de Somnolencia</h2>
                <div class="galeria">
                    {% for imagen, duracion in pares_somnolencia %}
                        <div class="imagen">
                            <img src="/media/{{ imagen }}" alt="Somnolencia">
                            <p class="tiempo">游 {{ duracion }} segundos</p>
                        </div>
                    {% empty %}
                        <p>No hay im치genes de somnolencia.</p>
                    {% endfor %}
                </div>
            </section>

            <section>
                <h2>游 Capturas de Distracci칩n</h2>
                <div class="galeria">
                    {% for imagen, duracion in pares_distraccion %}
                        <div class="imagen">
                            <img src="/media/{{ imagen }}" alt="Distracci칩n">
                            <p class="tiempo">游 {{ duracion }} segundos</p>
                        </div>
                    {% empty %}
                        <p>No hay im치genes de distracci칩n.</p>
                    {% endfor %}
                </div>
            </section>
        </div>

        <!-- TAB: GR츼FICAS -->
        <div id="tab-graficas" class="tab-content">
            <div class="grafico-title">游늵 Gr치fica del Reporte</div>
            <div id="grafico6" style="margin-top: 20px;"></div>
            <div class="grafico-title">游늳 Evoluci칩n de Tiempos de Somnolencia</div>
            <div class="grafico-title">
                <span>Promedio de somonolencia: </span>
                <span>{{promedio_somnolencia}}s</span>
            </div>
            <div class="grafico-title">
                <span>Total de tiempo de somnolencias: </span>
                <span>{{total_somnolencia}}s</span>
            </div>
            <div id="grafico_tiempos_somnolencia" style="height: 300px;"></div>
            <div class="grafico-title">游늳 Gr치fico de Distracciones</div>
            <div class="grafico-title">
                <span>Promedio de somonolencia: </span>
                <span>{{promedio_distraccion}}s</span>

            </div>
            <div class="grafico-title">
                <span>Total de tiempo de distracciones: </span>
                <span>{{total_distraccion}}s</span>
            </div>
            <div id="grafico_distraccion" style="margin-top: 30px;"></div>

            <div id="mi-div-grafico"></div>

        </div>
    </div>

    <!-- JS para alternar pesta침as y dibujar gr치fica -->
    <script>
        const dataReporte = {{ grafico_data|safe }};
        const tiemposSomnolencia = {{ grafico_data.tiempos_somnolencia|safe }};
        const datosGrafico = {
            total_tiempo_distraccion: {{ total_distraccion }},
            total_somnolencia: {{ total_somnolencia }},
            total_tiempo_evaluacion: {{ tiempo_concentracion.total_seconds}},
        };
        let graficaMostrada = false;

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.getAttribute('data-tab');


                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                btn.classList.add('active');
                document.getElementById('tab-' + tab).classList.add('active');


                if (tab === 'graficas' && !graficaMostrada) {
                    renderGraficoPastelReporte(dataReporte, "#grafico6");
                    renderGraficoLineaSomnolencia(tiemposSomnolencia, "#grafico_tiempos_somnolencia");
                    renderGraficoLineaDistraccion(dataReporte, "#grafico_distraccion");
                    renderGraficoPastelTiempo(datosGrafico, "#mi-div-grafico");
                    graficaMostrada = true;
                }
            });
        });
    </script>
</body>
</html>
