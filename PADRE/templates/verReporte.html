{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reporte del Ni√±o</title>
    <link rel="stylesheet" href="{% static 'css/verReporte.css' %}">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="{% static 'js/graficas_reportes.js' %}"></script>
</head>
<body>

    <div class="regresar">
        <a href="{% url 'profesor:estudiante' curso.id nino.id %}" class="boton-recuperar">‚Üê Regresar</a>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="datos">üìã Datos</button>
            <button class="tab-btn" data-tab="graficas">üìä Gr√°ficas</button>
        </div>
        <h1 style="text-align: center;">üìã Reporte de Evaluaci√≥n del Ni√±ooooo</h1>


        <div id="tab-datos" class="tab-content active">
            <div class="resumen">
                <div class="card"><h3>Puntaje</h3><p>{{ reporte.puntaje }}</p></div>
                <div class="card"><h3>Distracciones</h3><p>{{ reporte.distracciones }}</p></div>
                <div class="card"><h3>Somnolencias</h3><p>{{ reporte.somnolencias }}</p></div>
                <div class="card"><h3>Duraci√≥n</h3><p>{{ reporte.duracion_evaluacion }}</p></div>
            </div>

            <section>
                <h2>Capturas de Somnolencia</h2>
                <div class="galeria">
                    {% for imagen, duracion in pares_somnolencia %}
                        <div class="imagen">
                            <img src="/media/{{ imagen }}" alt="Somnolencia">
                            <p class="tiempo">üïí {{ duracion }} segundos</p>
                        </div>
                    {% empty %}
                        <p>No hay im√°genes de somnolencia.</p>
                    {% endfor %}
                </div>
            </section>

            <section>
                <h2>Capturas de Distracci√≥n</h2>
                <div class="galeria">
                    {% for imagen, duracion in pares_distraccion %}
                        <div class="imagen">
                            <img src="/media/{{ imagen }}" alt="Distracci√≥n">
                            <p class="tiempo">üïí {{ duracion }} segundos</p>
                        </div>
                    {% empty %}
                        <p>No hay im√°genes de distracci√≥n.</p>
                    {% endfor %}
                </div>
                <h2>Comentarios</h2>
                <h3>{{ reporte.comentario }}</h3>
            </section>
        </div>


        <div id="tab-graficas" class="tab-content">
           {% if total_distraccion > 4 or total_distraccion >4 %}
                <div class="grafico-title">üìä Gr√°fica del Reporte</div>
                <div id="grafico_Distraccion_Somnolencia" style="margin-top: 20px;"></div>
                <div class="grafico-title">üìà Evoluci√≥n de Tiempos de Somnolencia</div>
                <div class="grafico-title">
                    <span>Promedio de somonolencia: </span>
                    <span>{{promedio_somnolencia}}s</span>
                </div>
                <div class="grafico-title">
                    <span>Total de tiempo de somnolencias: </span>
                    <span>{{total_somnolencia}}s</span>
                </div>
                <div id="grafico_tiempos_somnolencia" style="height: 300px;"></div>
                <div class="grafico-title">üìà Gr√°fico de Distracciones</div>
                <div class="grafico-title">
                    <span>Promedio de somonolencia: </span>
                    <span>{{promedio_distraccion}}s</span>

                </div>
                <div class="grafico-title">
                    <span>Total de tiempo de distracciones: </span>
                    <span>{{total_distraccion}}s</span>
                </div>
                <div id="grafico_distraccion" style="margin-top: 30px;"></div>

                <div id="grafico_tiempos_de_evaluavion"></div>
           {% endif %}

        </div>
    </div>

    <script>
        const dataReporte = {{ grafico_data|safe }};
        const tiemposSomnolencia = {{ grafico_data.tiempos_somnolencia|safe }};
        const datosGrafico = {
            total_tiempo_distraccion: {{ total_distraccion }},
            total_somnolencia: {{ total_somnolencia }},
            total_tiempo_evaluacion: {{ tiempo_concentracion.total_seconds}},
        };
        let graficaMostrada = false;

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.getAttribute('data-tab');


                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                btn.classList.add('active');
                document.getElementById('tab-' + tab).classList.add('active');


                if (tab === 'graficas' && !graficaMostrada) {
                    renderGraficoPastelReporte(dataReporte, "#grafico_Distraccion_Somnolencia");
                    renderGraficoLineaSomnolencia(tiemposSomnolencia, "#grafico_tiempos_somnolencia");
                    renderGraficoLineaDistraccion(dataReporte, "#grafico_distraccion");
                    renderGraficoPastelTiempo(datosGrafico, "#grafico_tiempos_de_evaluavion");
                    graficaMostrada = true;
                }
            });
        });
    </script>
</body>
</html>
