{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Inicio de DetecciÃ³n</title>
    <link rel="stylesheet" href="{% static 'css/deteccion.css' %}">
</head>
<body>
    <a href="{% url 'niÃ±o:juegos_recomendados' %}">IA</a>
    <div class="container">
        <h1>ğŸ§  DetecciÃ³n de Somnolencia y DistracciÃ³n</h1>
        <p>La detecciÃ³n ha comenzado automÃ¡ticamente.</p>

        <p id="espera">â³ Esperando resultados...</p>
        <button id="btnFinalizar" onclick="finalizar()">Finalizar detecciÃ³n</button>

        <div id="resultados" class="result-box" style="display: none;">
            <h2>ğŸ“Š Resultados:</h2>
            <p><strong>ğŸ˜´ Somnolencias:</strong> <span id="s_count"></span></p>
            <p><strong>â±ï¸ Tiempos (s):</strong> <span id="s_tiempos"></span></p>
            <p><strong>ğŸ™ˆ Distracciones:</strong> <span id="d_count"></span></p>
            <p><strong>â±ï¸ Tiempos (s):</strong> <span id="d_tiempos"></span></p>
            <p><strong>ğŸ•’ DuraciÃ³n total (s):</strong> <span id="duracion"></span></p>
        </div>
    </div>

    <script>
    function finalizar() {
        const btn = document.getElementById("btnFinalizar");
        btn.disabled = true;
        document.getElementById("espera").innerText = "â³ Finalizando detecciÃ³n...";

        fetch("{% url 'niÃ±o:ia_fin' %}")
        .then(res => {
            if (!res.ok) {
                throw new Error("Respuesta del servidor invÃ¡lida: " + res.status);
            }
            return res.json();
        })
        .then(data => {
            document.getElementById("espera").style.display = "none";
            document.getElementById("resultados").style.display = "block";

            document.getElementById("s_count").innerText = data.somnolencias ?? 0;
            document.getElementById("s_tiempos").innerText = data.tiempos_somnolencia?.join(', ') || "N/A";
            document.getElementById("d_count").innerText = data.distracciones ?? 0;
            document.getElementById("d_tiempos").innerText = data.tiempos_distraccion?.join(', ') || "N/A";
            document.getElementById("duracion").innerText = data.duracion_total ?? 0;
        })
        .catch(err => {
            console.error("âš ï¸ Error:", err);
            document.getElementById("espera").innerText = "âŒ Error al obtener resultados.";
            alert("OcurriÃ³ un error: " + err.message);
            btn.disabled = false; // Permitir reintento
        });
    }
    </script>
</body>
</html>
