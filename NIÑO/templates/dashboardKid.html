{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Ni√±o</title>
  <link rel="stylesheet" href="{% static 'css/dashboardKid.css' %}">
</head>
<body>

  <!-- Bot√≥n del logo -->
  <a class="logo-btn">
    <img src="{% static 'img/logo.png' %}" alt="Logo">
  </a>

  <!-- Bot√≥n de configuraci√≥n -->
  <button class="settings-btn" onclick="openModal()">‚öôÔ∏è</button>

  <!-- Modal Configuraci√≥n -->
  <div id="configModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-content">
      <button class="modal-close-btn" onclick="closeModal(event)">‚úñ</button>
      <h2>Configuraci√≥n</h2>
      <div class="config-item">
        <label>Sonido:</label>
        <button onclick="toggleSonido()" id="btnSonido" class="config-btn">Activado</button>
      </div>
      <div class="config-item">
        <label>Texto:</label>
        <button onclick="toggleTexto()" id="btnTexto" class="config-btn">Normal</button>
      </div>
      <div class="config-item">
        <label>Ayuda:</label>
        <button onclick="mostrarAyuda()" class="config-btn">Ver ayuda</button>
      </div>
      <a href="{% url 'accounts:logout' %}" class="config-btn">Cerrar sesi√≥n</a>
    </div>
  </div>

  <!-- Modal: Ver Perfil -->
  <div id="profileViewModal" class="modal-overlay" onclick="closeProfileViewModal(event)">
    <div class="modal-content perfil-modal-content">
      <button class="modal-close-btn" onclick="closeProfileViewModal(event)">‚úñ</button>
      <h2 class="perfil-titulo">Mi Perfil</h2>

      <div class="perfil-row">
        <div class="img-preview">
          {% if ni√±o.foto_perfil %}
            <img src="{{ ni√±o.foto_perfil.url }}" alt="Foto actual" class="perfil-img-preview">
          {% else %}
            <img src="{% static 'img/Ni√±o.png' %}" alt="Imagen por defecto" class="perfil-img-preview">
          {% endif %}
        </div>
      </div>

      <div class="perfil-row">
        <label class="perfil-label">Nombre:</label>
        <div class="perfil-input">{{ ni√±o.nombres }}</div>
      </div>
      <div class="perfil-row">
        <label class="perfil-label">Apellido:</label>
        <div class="perfil-input">{{ ni√±o.apellidos }}</div>
      </div>
      <div class="perfil-row">
        <label class="perfil-label">Correo:</label>
        <div class="perfil-input">{{ ni√±o.email }}</div>
      </div>
      <div class="perfil-row">
        <label class="perfil-label">Usuario:</label>
        <div class="perfil-input">{{ ni√±o.usuario }}</div>
      </div>
      <div class="perfil-row">
        <label class="perfil-label">C√≥digo:</label>
        <div class="perfil-input">{{ ni√±o.codigo }}</div>
      </div>
      <div class="perfil-row">
        <label class="perfil-label"> Nacimiento:</label>
        <div class="perfil-input">{{ ni√±o.fecha_nac }}</div>
      </div>

      <div class="perfil-row guardar-row">
        <button class="config-btn" onclick="openEditProfileModal()">Editar perfil</button>
      </div>
    </div>
  </div>

  <!-- Modal: Editar Perfil -->
  <div id="editProfileModal" class="modal-overlay" onclick="closeEditProfileModal(event)">
    <div class="modal-content perfil-modal-content">
      <button class="modal-close-btn" onclick="closeEditProfileModal(event)">‚úñ</button>
      <h2 class="perfil-titulo">Editar Perfil</h2>

      <form id="editarPerfilForm" enctype="multipart/form-data" method="POST">
        {% csrf_token %}

        <div class="perfil-row">
          <div class="img-preview">
            {% if ni√±o.foto_perfil %}
              <img src="{{ ni√±o.foto_perfil.url }}" alt="Foto actual" class="perfil-img-preview">
            {% else %}
              <img src="{% static 'img/Ni√±o.png' %}" alt="Imagen por defecto" class="perfil-img-preview">
            {% endif %}
          </div>
          <div class="btn-cambiar">
            <label for="fotoEditInput" class="config-btn">Cambiar Foto</label>
            <input type="file" id="fotoEditInput" name="foto" accept="image/*" style="display:none">
          </div>
        </div>

        <div class="perfil-row">
          <label class="perfil-label">Nombres:</label>
          <input type="text" name="nombres" value="{{ ni√±o.nombres }}" class="perfil-input" required>
        </div>
        <div class="perfil-row">
          <label class="perfil-label">Apellidos:</label>
          <input type="text" name="apellidos" value="{{ ni√±o.apellidos }}" class="perfil-input" required>
        </div>
        <div class="perfil-row">
          <label class="perfil-label">email:</label>
          <input type="email" name="email" value="{{ ni√±o.email }}" class="perfil-input" required>
        </div>
        <div class="perfil-row">
          <label class="perfil-label">Usuario:</label>
          <input type="text" name="usuario" value="{{ ni√±o.usuario }}" class="perfil-input" required>
        </div>

        <div class="perfil-row guardar-row">
          <button type="submit" class="config-btn">Guardar cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de RECORD -->
  <div id="recordModal" class="modal-overlay" onclick="closeRecordModal(event)">
    <div class="modal-content record-modal">
      <button class="modal-close-btn" onclick="closeRecordModal(event)">‚úñ</button>
      <h2>üèÜ Mejores Records</h2>
      <div class="record-grid">
        {% for record in records %}
          <div class="record-box">
            <h3>Nivel {{ record.nivel }}</h3>
            <p><strong>üéØ Puntaje:</strong> {{ record.puntaje }}</p>
            <p><strong>‚è±Ô∏è Tiempo:</strong> {{ record.tiempo }}</p>
          </div>
        {% empty %}
          <p>No hay r√©cords a√∫n con puntaje mayor a 70.</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard">
    <div class="sidebar">
      <h3>Panel</h3>
      <div class="Juegos">
        <a href="{% url 'ni√±o:juegos_recomendados' %}" class="btnjugar">
          <button>
            <img src="{% static 'img/Juegos.png' %}" alt="Juegos">
            Juegos
          </button>
        </a>
        <button onclick="openProfileViewModal()">
          <img src="{% static 'img/Metrica.png' %}" alt="Perfil">
          Perfil
        </button>
      </div>
    </div>

    <div class="edu"><h2>Edu</h2></div>
    <div class="flex"><h2>flex</h2></div>

    <div class="perfil-nino">
      {% if ni√±o.foto_perfil %}
        <img src="{{ ni√±o.foto_perfil.url }}" alt="{{ ni√±o.nombre_completo }}" class="ni√±o-foto">
      {% else %}
        <img src="{% static 'img/Ni√±o.png' %}" alt="Imagen por defecto" class="ni√±o-foto">
      {% endif %}
      <div class="nombre-nino">{{ ni√±o.usuario }}</div>
    </div>

    <div class="main">
      <div class="progreso-wrapper align-bottom">
        <h2 class="titulo-progreso">Acceso R√°pido</h2>
        <div class="progreso-contenido">
          <button class="record-btn" onclick="openRecordModal()">
            <img src="{% static 'img/record.png' %}" alt="Record" class="record-icon">
          </button>
          <div class="barra-container">
            <p class="label-progreso">Progreso</p>
            <div class="barra-externa">
              <div class="barra-interna" style="width: {{ progreso_porcentaje }}%;"></div>
            </div>
            <p class="texto-progreso">{{ niveles_completados }} de {{ total_niveles }} niveles completados</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <img src="{% static 'img/perrocorriendo.gif' %}" alt="Perro corriendo" class="perro">

  <audio id="musicaDashboard" autoplay loop>
    <source src="{% static 'musica/Allegro in B flat Major (K.3) - Mozart (Free Sheets).mp3' %}" type="audio/mpeg">
    Tu navegador no soporta audio HTML5.
  </audio>

  <script src="{% static 'JS/dashboardKids.js' %}"></script>

</body>
</html>
